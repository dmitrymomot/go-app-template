# https://taskfile.dev

version: "3"

includes:
  build: ./BuildTasks.yml

tasks:
  default:
    silent: true
    deps:
      - sqlc

  run:
    desc: Run the local Turso DB.
    silent: true
    preconditions:
      - command -v turso
    cmds:
      - turso dev --db-file ./db/local.db

  sqlc:
    desc: Generate code from SQL queries.
    silent: true
    dir: ./db
    cmds:
      - sqlc generate

  new-migration:
    desc: Create new migration.
    aliases:
      - nm
    silent: true
    dir: ./db/sql/migrations
    cmds:
      - sql-migrate new {{.CLI_ARGS}}
      - go mod tidy

  migrate:
    desc: Run migrations.
    silent: true
    deps:
      - task: build:migration
    preconditions:
      - test -f .env
      - command -v ./bin/migrate
    cmds:
      - ./bin/migrate
    # sources:
    #   - ./db/sql/migrations/*.sql
